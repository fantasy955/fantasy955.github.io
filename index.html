<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<link rel="apple-touch-icon" sizes="76x76" href="./assets/img/favicon.ico">
	<link rel="icon" type="image/png" href="./custom/figures/favicon.png">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Enjoy Today! QaQ</title>
	<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no'
		name='viewport' />
	<!-- Costum -->
	<link rel="dns-prefetch" href="//cdn.mathjax.org" />

	<!-- Google Font -->
	<link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,700|Source+Sans+Pro:400,600,700"
		rel="stylesheet">
	<!-- Font Awesome Icons -->
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css"
		integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
	<!-- Main CSS -->
	<link href="./assets/css/main.css" rel="stylesheet" />
	<link href="./index.css" rel="stylesheet"/>
</head>

<body>
	<!--------------------------------------
NAVBAR
--------------------------------------->
	<nav class="container topnav navbar navbar-expand-lg navbar-light bg-white fixed-top">
		<div class="container" id="top">
			<div class="col-md-1 d-none d-md-block"><img id="img-profile-photo" src="custom/figures/progile_photo.png"
					class="img-fluid img-responsive" v-bind:alt="personName"></div>
			<a class="navbar-brand nav-link" style="margin-right: 0;"
				onclick="toTop()"><strong>{{personName}}</strong></a>
			<button class="navbar-toggler collapsed mb-3" type="button" data-toggle="collapse"
				data-target="#navbarColor02" aria-controls="navbarColor02" aria-expanded="false"
				aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="navbar-collapse collapse" id="navbarColor02">
				<ul id="categorylist" class="navbar-nav mr-auto d-flex align-items-center">
					<li class="nav-item" v-for="item in items">
						<a class="nav-link" style="padding-right: 0rem;" v-on:click="scrollIntoView"
							v-bind:name="item.sname">{{item.sname}}</a>
					</li>
				</ul>
			</div>
		</div>
	</nav>
	<!-- End Navbar -->


	<!--------------------------------------
HEADER
--------------------------------------->
	<div class="container" id="header">
		<div class="row justify-content-center">
			<div class="col-2" id="cityINFO">
				<h5 style="height: auto;">
					<p class="text-center">{{cityName}}<br>Weather</p>
				</h5>
			</div>
			<div class="col-2 mb-0">
				<img src="./custom/qweather-icons/icons/100.svg" fill="#1C242C" alt="QWeather" width="32" height="32">
			</div>
		</div>
	</div>
	<!-- End Header -->


	<!--------------------------------------
MAIN
--------------------------------------->
	<div class="container-xxl my-md-4 bd-layout main-content bg-white-50" id="main">
		<div class="row justify-content-start">
			<div class="col-md-1 pl-3 pr-3">
                <div class="sticky-top text-center" title="Visit my github">
					<a v-bind:href="github" title="visit my github">
						<svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="4em"
							width="4em" xmlns="http://www.w3.org/2000/svg">
							<path
								d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z">
							</path>
						</svg>
					</a>
                </div>
            </div>
			<div class="col-md-10" role="main">
				<div class="container jumbotron jumbotron-fluid mb-3 pt-0 pb-0 bg-gray position-relative"
					style="margin-bottom: 5px;" v-for="item in items" v-bind:id="['div-'+item.sname]">
					<h5 class="mt-1 btn btn-dark font-weight-bold"><span
							style="padding-bottom: 5px">{{item.aname}}</span></h5>
					<div class="mb-1 d-flex justify-content-center border-bottom"></div>
					<ol class="list-featured" v-bind:id="['ol-files-'+item.sname]">
						<li class="mb-md-2" v-for="file in item.currentpage.files">
							<div class="pl-3 justify-content-center">
								<h6 class="font-weight-bold" style="margin-bottom: 0;"><a class="text-dark"
										style="cursor: pointer;"
										v-on:click="(event) => toBlogDetailsPage(item.sname, file.name, item.path, event)">{{file.name}}</a>
								</h6>
								<div class="card-text text-muted small">
									Fantasy955
								</div>
								<small
									class="text-muted">{{file.updatetime.year}}年{{file.updatetime.mon}}月{{file.updatetime.day}}日
									更新</small>
							</div>
						</li>
					</ol>
					<div class="card-text mr-1" v-if="item.more" v-on:click="(event) => showAll(item.sname, event)">
						<p class="pl-md-1 pr-md-1 c-pointer text-primary">View All</p>
					</div>
					<div class="card-text mr-1" v-if="item.layaside"
						v-on:click="(event) => layAside(item.sname, event)">
						<p class="pl-md-1 pr-md-1 c-pointer text-primary">收起</p>
					</div>
					<div class="row pl-3 justify-content-center">
						<div class="card-text small" v-if="!item.layaside">
							<p class="text-muted">总共 {{item.totalPage}} 页, 当前第 {{item.pageindex+1}} 页</p>
						</div>
						<div class="ml-1 card-text small" v-if="!item.layaside">
							<p class="c-pointer bg-white" v-if="item.pageindex>0"
								v-on:click="(event)=>prePage(item.sname, event)">上一页</p>
						</div>
						<div class="ml-1 card-text small" v-if="!item.layaside">
							<p class="c-pointer badge-white" v-if="item.pageindex+1<item.totalPage"
								v-on:click="(event)=>nextPage(item.sname, event)">下一页</p>
						</div>
					</div>
				</div>
			</div>
		</div>

	</div>
	<!-- End MAIN -->

	<!--------------------------------------
FOOTER
--------------------------------------->
	<div class="container mt-5">
		<footer class="bg-white border-top p-3 text-muted small">
			<div class="row align-items-center justify-content-between">
				<div>
					<span class="navbar-brand mr-2"><strong>WeiJL</strong></span> Copyright &copy;
					<script>document.write(new Date().getFullYear())</script>
					. All rights reserved.
				</div>
				<div>
					Made with <a target="_blank" class="text-secondary font-weight-bold"
						href="https://www.wowthemes.net/mundana-free-html-bootstrap-template/">Mundana Theme</a> by
					WowThemes.net.
				</div>
			</div>
		</footer>
	</div>
	<!-- End Footer -->

	<!--------------------------------------
JAVASCRIPTS
--------------------------------------->
	<script src="./assets/js/vendor/jquery.min.js" type="text/javascript"></script>
	<script src="./assets/js/vendor/popper.min.js" type="text/javascript"></script>
	<script src="./assets/js/vendor/bootstrap.min.js" type="text/javascript"></script>
	<script src="./assets/js/functions.js" type="text/javascript"></script>
	<script src="./assets/vue/dist/vue.global.js"></script>
	<!-- <script src="https://unpkg.com/vue@3"></script> -->
	<!-- <script src="https://cdn.bootcdn.net/ajax/libs/vue/3.2.33/vue.global.js"></script> -->
	<script src="./assets/axios/dist/axios.js" type="text/javascript"></script>
	<!-- <script src="https://cdn.bootcdn.net/ajax/libs/axios/0.21.1/axios.min.js" type="text/javascript"></script> -->
	<!-- <script src="./node_modules/showdown/dist/showdown.js" type="text/javascript"></script> -->
	<!-- <script src="./node_modules/marked/marked.min.js"></script> -->
	<!-- <script src="https://cdn.bootcdn.net/ajax/libs/marked/4.0.18/marked.min.js"></script> -->
	<!-- <script src="./index.js" type="module"></script> -->
	<script src="./custom/config.js"></script>

	<script type="text/javascript">
		axios.get("./custom/menu.json").then((res) => {
			var menuData = res.data['categories'];
			var categories = {};
			for (x in menuData) {
				let categoryInfo = menuData[x];
				categories[categoryInfo['sname']] = categoryInfo;
			}
			const TopComponent = {
				data() {
					return {
						personName: 'WeiJL',
						items: categories,
					}
				},
				methods: {
					scrollIntoView(event) {
						if (event) {
							let el = document.getElementById('div-' + event.target.name);
							if (el) {
								el.scrollIntoView({ behavior: 'smooth' });
							}
						}
					},
				}
			};
			const topApp = Vue.createApp(TopComponent);
			topApp.mount('#top');

			let filesPromises = []
			for (x in categories) {
				categoryInfo = categories[x];
				const t = x;
				categories[t]['more'] = false;
				categories[t]['filecode'] = 200;
				categories[t]['pages'] = [];
				categories[t]['pageindex'] = 0;
				categories[t]['layaside'] = false;
				let filesPromise = axios.get(categoryInfo.path + "/list.json").then((res) => {
					return new Promise(function (resolve, reject) {
						if (res) {
							let datas = res.data;
							let pages = res.data.pages;
							let totalPage = datas.totalPage;
							if (totalPage > 1) {
								categories[t]['more'] = true;
							}
							categories[t]['files'] = datas.files;
							categories[t]['pages'] = pages;
							categories[t]['totalPage'] = totalPage;
							categories[t]['currentpage'] = JSON.parse(JSON.stringify(pages[0])); // 需要进行深拷贝，否则会与pages[0]绑定
							resolve(categories[t]);
						} else {
							reject(res);
						}
					});
				}).catch(function (error) {
					categories[t]['filecode'] = 201;
					return categories[t];
				});
				filesPromises.push(filesPromise);
			}
			Promise.all(filesPromises).then((results) => {
				console.log(categories);
			}, (error) => {
				console.log(error);
			}).then(() => {
				const MainComponent = {
					data() {
						return {
							items: categories,
							github: github,
						}
					},
					methods: {
						nextPage(categorySName, event) {
							this.items[categorySName].pageindex += 1;
							this.items[categorySName].currentpage = JSON.parse(JSON.stringify(
								this.items[categorySName].pages[this.items[categorySName].pageindex]));
						},
						prePage(categorySName, event) {
							this.items[categorySName].pageindex -= 1;
							this.items[categorySName].currentpage = JSON.parse(JSON.stringify(
								this.items[categorySName].pages[this.items[categorySName].pageindex]));
						},
						toBlogDetailsPage(categorySName, fileName, realPath, event) {
							let tmp = realPath.split('/');
							window.localStorage.setItem('categoryPath', tmp[tmp.length - 1]);
							let realDir = tmp[tmp.length - 1];
							let target = `./blogs/?ca=${categorySName}&n=${fileName}&r=${realDir}`;
							console.log(target);
							window.location.href = target;
						},
						showAll(categorySName, event) {
							this.items[categorySName].prePage = JSON.parse(JSON.stringify(
								this.items[categorySName].currentpage));
							this.items[categorySName].currentpage.files = JSON.parse(JSON.stringify(
								this.items[categorySName].files));
							this.items[categorySName].more = false;
							this.items[categorySName].layaside = true;
							console.log(this.items[categorySName]);
						},
						layAside(categorySName, event) {
							this.items[categorySName].currentpage = JSON.parse(JSON.stringify(
								this.items[categorySName].prePage));
							this.items[categorySName].more = true;
							this.items[categorySName].layaside = false;
							let el = document.getElementById(`div-${categorySName}`);
							if (el) {
								el.scrollIntoView({ behavior: 'smooth' });
							}
						},
						toMyGithub(){
							window.location.href = github;
						}
					}
				};
				const mainApp = Vue.createApp(MainComponent);
				mainApp.mount('#main');
			})
		});

		function toTop() {
			document.documentElement.scrollTo({ top: 0, behavior: 'smooth' })
		}


		function getWeather() {
			var qweatherKEY = "1be8d61b1f574487a06001148aa603b5"
			var weatherURLBase = "https://devapi.qweather.com/v7/weather/now?"
			var cityURLBase = "https://geoapi.qweather.com/v2/city/lookup?"
			var locationID = "101250101" // 长沙
			$.ajax({
				"url": weatherURLBase + "key=" + qweatherKEY + "&location=" + locationID,
				"success": function (json) {
					console.log(json)
				},
				"error": function (json) {
					console.log("请求天气信息失败, info:" + json)
				}
			})
		}
		// getWeather()

		const HeaderComponent = {
			data() {
				return {
					personName: 'WeiJL',
					cityName: "长沙市",
				}
			}
		};
		const headerApp = Vue.createApp(HeaderComponent);
		headerApp.mount('#header');
	</script>
</body>

</html>