<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<link rel="apple-touch-icon" sizes="76x76" href="./assets/img/favicon.ico">
	<link rel="icon" type="image/png" href="./custom/figures/favicon.png">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Enjoy Today! QaQ</title>
	<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no'
		name='viewport' />
	<!-- Costum -->
	<link rel="dns-prefetch" href="//cdn.mathjax.org" />

	<!-- Google Font -->
	<link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,700|Source+Sans+Pro:400,600,700"
		rel="stylesheet">
	<!-- Font Awesome Icons -->
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css"
		integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
	<!-- Main CSS -->
	<link href="./assets/css/main.css" rel="stylesheet" />
	<style>
		.centerFlexParent {
			display: flex;
			justify-content: center
		}

		.nav-link {
			cursor: pointer;
		}
	</style>
</head>

<body>
	<!--------------------------------------
NAVBAR
--------------------------------------->
	<nav class="container topnav navbar navbar-expand-lg navbar-light bg-white fixed-top">
		<div class="container" id="top">
			<div class="col-md-1 d-none d-md-block"><img id="img-profile-photo" src="custom/figures/progile_photo.png"
					class="img-fluid img-responsive" v-bind:alt="personName"></div>
			<a class="navbar-brand nav-link" style="margin-right: 0;"
				onclick="toTop()"><strong>{{personName}}</strong></a>
			<button class="navbar-toggler collapsed mb-3" type="button" data-toggle="collapse"
				data-target="#navbarColor02" aria-controls="navbarColor02" aria-expanded="false"
				aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="navbar-collapse collapse" id="navbarColor02">
				<ul id="categorylist" class="navbar-nav mr-auto d-flex align-items-center">
					<li class="nav-item" v-for="item in items">
						<a class="nav-link" style="padding-right: 0rem;" v-on:click="scrollIntoView"
							v-bind:name="item.sname">{{item.sname}}</a>
					</li>
				</ul>
			</div>
		</div>
	</nav>
	<!-- End Navbar -->


	<!--------------------------------------
HEADER
--------------------------------------->
	<div class="container" id="header">
		<div class="row justify-content-center">
			<div class="col-2" id="cityINFO">
				<h5 style="height: auto;">
					<p class="text-center">{{cityName}}<br>Weather</p>
				</h5>
			</div>
			<div class="col-2 mb-0">
				<img src="./custom/qweather-icons/icons/100.svg" fill="#1C242C" alt="QWeather" width="32" height="32">
			</div>
		</div>
	</div>
	<!-- End Header -->


	<!--------------------------------------
MAIN
--------------------------------------->
	<div id="main">
		<div class="container jumbotron jumbotron-fluid mb-3 pt-0 pb-0 bg-gray position-relative"
			style="margin-bottom: 5px;" v-for="item in items" v-bind:id="['div-'+item.sname]">
			<h5 class="mt-1 btn btn-dark font-weight-bold"><span style="padding-bottom: 5px">{{item.aname}}</span></h5>
			<div class="mb-1 d-flex justify-content-center border-bottom"></div>
			<ol class="list-featured" v-bind:id="['ol-files-'+item.sname]">
				<li class="mb-md-2" v-for="file in item.currentpage.files">
					<div class="pl-3 justify-content-center">
						<h6 class="font-weight-bold" style="margin-bottom: 0;"><a class="text-dark"
								style="cursor: pointer;" v-on:click="(event) => toBlogDetailsPage(item.sname, file.name, item.path, event)">{{file.name}}</a></h6>
						<div class="card-text text-muted small">
							Fantasy955
						</div>
						<small
							class="text-muted">{{file.updatetime.year}}年{{file.updatetime.mon}}月{{file.updatetime.day}}日
							更新</small>
					</div>
				</li>
			</ol>
			<div class="card-text mr-1" v-if="item.more" v-on:click="(event) => showAll(item.sname, event)">
				<p class="pl-md-1 pr-md-1 c-pointer text-primary">View All</p>
			</div>
			<div class="card-text mr-1" v-if="item.layaside" v-on:click="(event) => layAside(item.sname, event)">
				<p class="pl-md-1 pr-md-1 c-pointer text-primary">收起</p>
			</div>
			<div class="row pl-3 justify-content-center">
				<div class="card-text small" v-if="!item.layaside">
					<p class="text-muted">总共 {{item.totalPage}} 页, 当前第 {{item.pageindex+1}} 页</p>
				</div>
				<div class="ml-md-1 card-text small" v-if="!item.layaside">
					<p class="c-pointer bg-white" v-if="item.pageindex>0"
						v-on:click="(event)=>prePage(item.sname, event)">上一页</p>
				</div>
				<div class="ml-md-1 card-text small" v-if="!item.layaside">
					<p class="c-pointer badge-white" v-if="item.pageindex+1<item.totalPage"
						v-on:click="(event)=>nextPage(item.sname, event)">下一页</p>
				</div>
			</div>
		</div>
	</div>
	<!-- End MAIN -->

	<!--------------------------------------
FOOTER
--------------------------------------->
	<div class="container mt-5">
		<footer class="bg-white border-top p-3 text-muted small">
			<div class="row align-items-center justify-content-between">
				<div>
					<span class="navbar-brand mr-2"><strong>WeiJL</strong></span> Copyright &copy;
					<script>document.write(new Date().getFullYear())</script>
					. All rights reserved.
				</div>
				<div>
					Made with <a target="_blank" class="text-secondary font-weight-bold"
						href="https://www.wowthemes.net/mundana-free-html-bootstrap-template/">Mundana Theme</a> by
					WowThemes.net.
				</div>
			</div>
		</footer>
	</div>
	<!-- End Footer -->

	<!--------------------------------------
JAVASCRIPTS
--------------------------------------->
	<script src="./assets/js/vendor/jquery.min.js" type="text/javascript"></script>
	<script src="./assets/js/vendor/popper.min.js" type="text/javascript"></script>
	<script src="./assets/js/vendor/bootstrap.min.js" type="text/javascript"></script>
	<script src="./assets/js/functions.js" type="text/javascript"></script>
	<script src="./assets/vue/dist/vue.global.js"></script>
	<!-- <script src="https://unpkg.com/vue@3"></script> -->
	<!-- <script src="https://cdn.bootcdn.net/ajax/libs/vue/3.2.33/vue.global.js"></script> -->
	<script src="./assets/axios/dist/axios.js" type="text/javascript"></script>
	<!-- <script src="https://cdn.bootcdn.net/ajax/libs/axios/0.21.1/axios.min.js" type="text/javascript"></script> -->
	<!-- <script src="./node_modules/showdown/dist/showdown.js" type="text/javascript"></script> -->
	<!-- <script src="./node_modules/marked/marked.min.js"></script> -->
	<!-- <script src="https://cdn.bootcdn.net/ajax/libs/marked/4.0.18/marked.min.js"></script> -->
	<!-- <script src="./index.js" type="module"></script> -->
	<script src="./custom/config.js"></script>

	<script type="text/javascript">
		axios.get("./custom/menu.json").then((res) => {
			var menuData = res.data['categories'];
			var categories = {};
			for (x in menuData) {
				let categoryInfo = menuData[x];
				categories[categoryInfo['sname']] = categoryInfo;
			}
			const TopComponent = {
				data() {
					return {
						personName: 'WeiJL',
						items: categories,
					}
				},
				methods: {
					scrollIntoView(event) {
						if (event) {
							let el = document.getElementById('div-' + event.target.name);
							if (el) {
								el.scrollIntoView({ behavior: 'smooth' });
							}
						}
					},
				}
			};
			const topApp = Vue.createApp(TopComponent);
			topApp.mount('#top');

			let filesPromises = []
			for (x in categories) {
				categoryInfo = categories[x];
				const t = x;
				categories[t]['more'] = false;
				categories[t]['filecode'] = 200;
				categories[t]['pages'] = [];
				categories[t]['pageindex'] = 0;
				categories[t]['layaside'] = false;
				let filesPromise = axios.get(categoryInfo.path + "/list.json").then((res) => {
					return new Promise(function (resolve, reject) {
						if (res) {
							let datas = res.data;
							let pages = res.data.pages;
							let totalPage = datas.totalPage;
							if (totalPage > 1) {
								categories[t]['more'] = true;
							}
							categories[t]['files'] = datas.files;
							categories[t]['pages'] = pages;
							categories[t]['totalPage'] = totalPage;
							categories[t]['currentpage'] = JSON.parse(JSON.stringify(pages[0])); // 需要进行深拷贝，否则会与pages[0]绑定
							resolve(categories[t]);
						} else {
							reject(res);
						}
					});
				}).catch(function (error) {
					categories[t]['filecode'] = 201;
					return categories[t];
				});
				filesPromises.push(filesPromise);
			}
			Promise.all(filesPromises).then((results) => {
				console.log(categories);
			}, (error) => {
				console.log(error);
			}).then(() => {
				const MainComponent = {
					data() {
						return {
							items: categories,
						}
					},
					methods: {
						nextPage(categorySName, event) {
							this.items[categorySName].pageindex += 1;
							this.items[categorySName].currentpage = this.items[categorySName].pages[this.items[categorySName].pageindex];
						},
						prePage(categorySName, event) {
							this.items[categorySName].pageindex -= 1;
							this.items[categorySName].currentpage = this.items[categorySName].pages[this.items[categorySName].pageindex];
						},
						toBlogDetailsPage(categorySName, fileName, realPath, event){
							let tmp = realPath.split('/');
							window.localStorage.setItem('categoryPath', tmp[tmp.length-1]);
							let realDir = tmp[tmp.length-1];
							let target = `./blogs/?ca=${categorySName}&n=${fileName}&r=${realDir}`;
							console.log(target);
							window.location.href = target;
						},
						showAll(categorySName, event){
							this.items[categorySName].currentpage.files = this.items[categorySName].files;
							this.items[categorySName].more = false;
							this.items[categorySName].layaside = true;
							console.log(this.items[categorySName]);
						},
						layAside(categorySName, event){
							this.items[categorySName].currentpage.files = this.items[categorySName].pages[0].files;
							this.items[categorySName].more = true;
							this.items[categorySName].layaside = false;
							console.log(this.items[categorySName].currentpage);
							let el = document.getElementById(`div-${categorySName}`);
							if (el) {
								el.scrollIntoView({ behavior: 'smooth' });
							}
						}
					}
				};
				const mainApp = Vue.createApp(MainComponent);
				mainApp.mount('#main');
			})
		});

		function toTop() {
			document.documentElement.scrollTo({ top: 0, behavior: 'smooth' })
		}


		function getWeather() {
			var qweatherKEY = "1be8d61b1f574487a06001148aa603b5"
			var weatherURLBase = "https://devapi.qweather.com/v7/weather/now?"
			var cityURLBase = "https://geoapi.qweather.com/v2/city/lookup?"
			var locationID = "101250101" // 长沙
			$.ajax({
				"url": weatherURLBase + "key=" + qweatherKEY + "&location=" + locationID,
				"success": function (json) {
					console.log(json)
				},
				"error": function (json) {
					console.log("请求天气信息失败, info:" + json)
				}
			})
		}
		// getWeather()

		const HeaderComponent = {
			data() {
				return {
					personName: 'WeiJL',
					cityName: "长沙市",
				}
			}
		};
		const headerApp = Vue.createApp(HeaderComponent);
		headerApp.mount('#header');
	</script>
</body>

</html>