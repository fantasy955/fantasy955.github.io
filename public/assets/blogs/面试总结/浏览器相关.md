## 关键渲染路径

关键渲染路径就是浏览器HTML、CSS、JavaScript渲染为用户可以看见的界面的过程。

首先需要将HTML解析为DOM树，在解析的过程中会越到一些阻塞的情况，例如去请求和执行js脚本，以及将CSS解析为CSSOM树。**CSS 是渲染阻塞的**：浏览器会阻塞页面渲染直到它接收和执行了所有的 CSS。**CSS 是渲染阻塞是因为规则可以被覆盖**（而DOM是增量的，不会覆盖之前的内容），所以内容不能被渲染直到 CSSOM 的完成。构建 `DOM树` 和 构建 `CSSOM树` 是并行的。

CSSOM（CSS对象模型）与DOM结合生成渲染树，之后计算元素的**位置和大小**，这个阶段称为Layout，回流就是再次执行这个阶段。

在Painting阶段将每个节点的像素画到页面上，重绘是再次执行这个阶段。

### 性能优化

- 减少调用dom.offsetWidth的次数，因此浏览器会执行回流保证得到正确的宽度；
- 如果需要添加多个元素，可以先将元素添加到Fragment中，再添加到DOM中，或者使用`display:none`隐藏父级元素；
- 使用cssText或者className一次性改变样式；

### 参考资料

- [前端性能指标和优化目标——布局(layout) 与绘制(paint)_背太阳的牧羊人的博客-CSDN博客_布局和绘制](https://blog.csdn.net/u013565133/article/details/114406815)

---

## async和defer

`async` 和 `defer` 都仅对外部脚本有效；`async` 标志的脚本文件一旦`加载完成就立即执行`；而 `defer` 标志的脚本文件会在 **HTML解析完成**且**DOM构建完毕**后再执行；（也就是说`defer`是延迟执行，`async`是异步执行）；如果同时使用`async`和`defer`属性，`defer`不起作用，浏览器行为由`async`属性决定。`DOMContentLoaded` 事件会**等待** `defer` 的脚本执行完后才触发。

