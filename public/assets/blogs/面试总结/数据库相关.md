## 索引

### 主键和索引

主键和索引是两个不同的概念。主键用于唯一标识表中某一行的属性或属性组，而索引用于快速寻找具有特定值的记录。一个表只能有一个主键，但可以有多个候选索引。主键列不允许空值，而索引列允许空值。主键是逻辑键，索引是物理键。

索引是一种物理结构，用于快速查询数据。

主键是逻辑键，数据库不允许出现重复的主键。

索引和数据库表通常是存储在不同的文件中的。具体的存储方式取决于数据库管理系统（DBMS）的实现。

当执行查询时，如果查询条件中使用了索引列，数据库会自动使用索引来加速查询。数据库会根据索引中的信息来快速定位到符合条件的记录，然后再从表中获取这些记录的详细信息。

### 聚簇索引

是的，这句话是正确的。聚簇索引并不是一种单独的索引类型，而是一种数据存储方式。

聚簇描述描述的是数据表中的数据按照数据项在叶子节点中的排序顺序保存在物理设备上的特征，对应的索引表就是聚簇索引。由于聚簇索引会影响数据的物理存储顺序，因此一个表只能有一个聚簇索引。

主键列和聚簇索引之间有密切的关系**。聚簇索引并不是一种单独的索引类型**，而是一种数据存储方式。**它是按照每张表的主键构造一颗B+树**，同时叶子节点中存放的就是整张表的行记录数据。这意味着表中的行是按照主键顺序存储在索引的叶子节点上。由于聚簇索引会影响数据的物理存储顺序，因此一个表只能有一个聚簇索引。

### B+树

B+树是一种树形数据结构，它是一个n叉树，每个节点通常有多个孩子。一棵B+树包含根节点、内部节点和叶子节点。B+树的内部节点不存储数据，只起到索引作用，它的叶子节点才存储数据。

对于一棵m阶的B+树，其内部结点的结构如下：对于每一个形如`<P1,K1,P2,K2,...,Pc-1,Kc-1,Pc>`的内部结点，其中`c≤a`，每一个Pi表示指向子树根结点的指针，Ki表示关键字值。对于每一个内部结点中的关键字值均满足：`K1<K2<...<Kc-1`。对于一个位于Pi所指向的子树中的结点X而言，满足：当1<i<c时，均有Ki-1<X≤Ki；当i=c时，X>Kc-1；当i=1时，X≤K1。每一个内部结点最多有a个指向子树的指针，即c最大取a。

对于一棵m阶的B+树，其叶子结点的结构如下：对于每一个形如`<<K1,D1>,<K2,D2>,...,<Kc-1,Dc-1>,Pnext>`的叶子结点，其中 c≤b, Di是一个数据指针（指向磁盘上值等于 Ki 的真实记录的指针或包含记录 Ki 的磁盘文件块）， Ki 是一个关键字， Pnext 表示 B+ 树中指向下一个叶子结点的指针。对任意一个叶子结点均有： `K1<K2<...<Kc-1, c≤b`. 每一个叶子结点至少包含 `ceil(a/2)` 个值。所有的叶子结点在同一层。使用 Pnext 指针可以遍历所有的叶子结点，就和单链表一样，从而实现对磁盘上记录的有序访问。

总之，B+树是一种n叉树形数据结构，它包含根节点、内部节点和叶子节点。内部节点不存储数据，只起到索引作用；叶子节点存储数据。

### 重建索引

如果索引对应的数据存储位置发生了变化，数据库会自动更新索引以保持索引和数据之间的一致性。这通常是通过在原有的索引上进行修改来实现的，而不是重建整个索引。

在某些情况下，可能需要重建整个索引。例如：

- 索引碎片过多：当表中的数据被频繁更新或删除时，索引可能会产生大量的碎片。这会降低索引的查询效率。在这种情况下，可以通过重建索引来消除碎片，提高索引的查询效率。
- 索引损坏：如果索引由于某些原因（如硬件故障、软件错误等）损坏，可能需要重建索引来恢复数据的完整性。
- 更改索引结构：如果需要更改索引的结构（如更改索引列、更改索引类型等），则需要重建索引。

个表可以有多个索引。索引是一种用于加速查询的数据结构，它可以帮助数据库快速定位到满足查询条件的数据行。一个表可以有多个索引，每个索引都可以针对不同的查询条件进行优化。

例如，在一个员工表中，可以创建一个基于员工姓名的索引来加速基于姓名的查询，同时还可以创建一个基于员工部门的索引来加速基于部门的查询。这样，在执行查询时，数据库可以根据查询条件选择合适的索引来加速查询。

需要注意的是，虽然索引可以加速查询，但是创建过多的索引会增加数据库的维护成本，并且**会降低数据更新和插入的性能**。因此，在创建索引时应该根据实际情况进行权衡。

### B+树、B树(B-Tree)

B+树和B树都适用于外查找。外查找是指在外存储器上进行的查找。由于外存储器的存取速度较慢，**因此外查找算法的研究重点在于减少访问外存储器的次数**。B树是一种适用于外查找的树，它是一种平衡的多叉树。

B+树和B树的区别在于，B+树的所有关键字都在叶子节点中出现，非叶子节点作为叶子节点的索引，而B树的所有关键字在整颗树中出现，**且只出现一次**，非叶子节点可以命中。

