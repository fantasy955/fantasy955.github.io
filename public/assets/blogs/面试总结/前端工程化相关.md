## 如何搭建前端脚手架(CLI)

CLI即命令行界面，也就是一个命令行工具。

脚手架可以创建项目时的重复性操作，统一开发风格（eslint和stylelint），规范项目目录，让开发更专注于业务。

## TreeShaking

TreeShaking是一种减小代码体积的技术，它的原理是检测EM模块中哪些被导出的值没有被使用，这些没有被使用的值不会出现在打包的产物中。

在实际使用中，Treeshaking通常与ES6的模块化机制结合使用。**因为ES6的模块化机制是静态的，可以在编译时分析出依赖关系**，从而进行剪枝操作。对于其他的代码（如CommonJS、AMD等），因为它们的依赖关系是动态的，无法在编译时确定，所以无法进行Treeshaking优化。

Treeshaking的实现需要满足两个条件：代码必须是纯函数，且不会产生副作用。如果代码中存在副作用，例如在函数内部修改全局变量，那么就无法进行Treeshaking。另外，Treeshaking的实现也需要支持Tree Shaking的标准。在Webpack中，需要使用支持Tree Shaking标准的模块打包器，如Webpack 2或更高版本，并且需要开启`production`模式，才能实现Treeshaking优化。

## webpack

在Webpack的运行过程中，每次执行Webpack命令都会创建一个新的Compiler实例。一个Compiler实例负责一次新的编译过程，并且会生成一个或多个Compilation实例。

Compilation对象是Webpack在每次构建中创建的，**它包含了当前的模块资源、编译生成的资源、变化的文件等信息**。在Compilation对象中，Webpack会将模块解析后的信息存放在模块映射表（module map）中，方便后续处理。

在Webpack中，一个Compilation对象只负责一次编译过程中的**资源的编译和输出**。每次编译都会生成一个新的Compilation对象，Webpack会在内存中保存最近一次的Compilation对象，以便后续的增量编译。

## Vite

- 将模块分为依赖和源码，依赖是开发时不会改动的纯JavaScript。源码一般不是直接的JS文件。
- 依赖存在多种模块化格式，使用ESBuild预构建**依赖**，esbuild使用go编写，速度更快。
- 基于ES模块化，提升开发过程的体验，由于无需构建整个应用，开发服务器启动更快，热模块替换速度更快。以原生ESM方式提供源码，让浏览器进行模块的导入，Vite 只需要在浏览器请求源码时进行转换并按需提供源码。

> 为什么生产环境还是要打包？

主要是为了优化性能。由于模块的嵌套嵌入，ES模块化会造成额外的网络往返。

打包可以进行tree-shaking、懒加载和 chunk 分割。

> 为什么不用esbuild打包

esbuild无法与我们经常用到其他前端工具或框架进行配合，例如eslint和postcss。esbuild无法进行代码分割和CSS处理。	