### Observer在组件卸载时的问题

在组件的`mounted`生命周期初始化一个`ResizeObserver`并对`canvas`进行观察，当`canvas`的大小变化时，更新图像大小与canvas渲染大小间的比例，确保坐标的正确性。

```js
this.observer = new ResizeObserver((entries) => {
	this.updateCanvasRatio();
});
this.observer.observe(this.$refs.canvas);
```

```js
updateCanvasRatio: function () {
    const clientWidth = this.$refs.canvas.clientWidth;
    const imageWidth = this.$refs.canvas.width;
    this.ratio = imageWidth / clientWidth;
    // console.log('update ratio', this.ratio)
    this.$refs.container.style.height = `${this.$refs.canvas.clientHeight + 50}px`;
},
```

在组件卸载时，我们当然需要停止这个观察：

```js
unmounted() {
	this.observer.disconnect();
},
```

但是，在卸载之后，还是会触发一次`updateCanvasRatio`函数，但是此时`this.$refs.canvas`已经不存在了，导致控制台报错。

解决方式是在回调函数中加上条件判断：

```js
if (!this.$refs.canvas) {
	return;
}
```

为什么有这种现象，个人猜测是：当组件被销毁时，`canvas`元素大小确实发送了变化，因此回调函数被添加到微任务队列中了，之后才进入`unmounted`生命周期停止观察。